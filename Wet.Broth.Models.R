library(readxl)
WM = read_excel("~/Dropbox/Matt Igo - Schaffner Lab/Dissertation/Lab Modeling Project/Results/Results.xlsx", 
                sheet = "ModelR")

library(caret)
model1 = lm(`WB.7.0.3`~Time1, data = WM)
summary(model1)
AIC(model1)
pred1=predict(model1,WM)
RMSE(pred1,WM$`WB.7.0.3`)

model2 = lm(`WB.7.0.7`~Time2, data = WM)
summary(model2)
AIC(model2)
pred2=predict(model2,WM)
RMSE(pred2,WM$`WB.7.0.7`)

model3 = lm(`WB.21.0.3`~Time3, data = WM)
summary(model3)
AIC(model3)
pred3=predict(model3,WM)
RMSE(pred3,WM$`WB.21.0.3`)

model4 = lm(`WB.21.0.7`~Time4, data = WM)
summary(model4)
AIC(model4)
pred4=predict(model4,WM)
RMSE(pred4,WM$`WB.21.0.7`)

model5 = lm(`WB.37.0.3`~Time5, data = WM)
summary(model5)
AIC(model5)
pred5=predict(model5,WM)
RMSE(pred5,WM$`WB.37.0.3`)

model6 = lm(`WB.37.0.7`~Time6, data = WM)
summary(model6)
AIC(model6)
pred6=predict(model6,WM)
RMSE(pred6,WM$`WB.37.0.7`)

###############Weibull
weib1 = nls(`WB.7.0.3`~NO - (Time1/delta)^p, start = list(delta =5, p=1, NO=5), trace = T, data = WM)
summary(weib1)
AIC(weib1)
anova(weib1,model1)
predw1=predict(weib1,WM)
RMSE(predw1,WM$`WB.7.0.3`)
anova(weib1,model1)
plot(`WB.7.0.3`~Time1, data =WM)
lines(Time1, data = WM, predict(weib), col='blue')

weib2 = nls(`WB.7.0.7`~NO - (Time2/delta)^p, start = list(delta =5, p=1, NO=5), trace = T, data = WM)
summary(weib2)
AIC(weib2)
anova(weib2,model2)
predw2=predict(weib2,WM)
RMSE(predw2,WM$`WB.7.0.7`)

weib3 = nls(`WB.21.0.3`~NO - (Time3/delta)^p, start = list(delta =5, p=1, NO=5), trace = T, data = WM)
summary(weib3)
AIC(weib3)
anova(weib3,model3)
predw3=predict(weib3,WM)
RMSE(predw3,WM$`WB.21.0.3`)

weib4 = nls(`WB.21.0.7`~NO - (Time4/delta)^p, start = list(delta =5, p=1, NO=5), trace = T, data = WM)
summary(weib4)
AIC(weib4)
anova(weib4,model4)
predw4=predict(weib4,WM)
RMSE(predw4,WM$`WB.21.0.7`)

weib5 = nls(`WB.37.0.3`~NO - (Time5/delta)^p, start = list(delta =5, p=1, NO=5), trace = T, data = WM)
summary(weib5)
AIC(weib5)
anova(weib5,model5)
predw5=predict(weib5,WM)
RMSE(predw5,WM$`WB.37.0.3`)

weib6 = nls(`WB.37.0.7`~NO - (Time6/delta)^p, start = list(delta =1, p=1, NO=5), trace = T, data = WM)
summary(weib6)
AIC(weib6)
anova(weib6,model6)
predw6=predict(weib6,WM)
RMSE(predw6,WM$`WB.37.0.7`)

###################Biphasic
library(nlsr)
?`nlsr-package`
biphas1=nls(`WB.7.0.3`~NO+log10(f*exp(-k1*Time1)+(1-f)*exp(0*Time1)), start = list(f=0.8186,k1=0.0483,NO=5.95), trace = T, data=WM)
plot(`WB.7.0.3`~Time1, data =WM)
lines(WM$Time1, predict(biphas1), col='blue')
summary(biphas1)
AIC(biphas1)
anova(biphas1,model6)
predw1=predict(biphas1,WM)
RMSE(predw1,WM$`WB.7.0.3`)

biphas2=nls(`WB.7.0.7`~NO+log10(f*exp(-k1*Time2)+(1-f)*exp(0*Time2)), start = list(f=.99,k1=0.05,NO=6), trace = T, data=WM)
plot(`WB.7.0.7`~Time2, data =WM)
lines(WM$Time2, predict(biphas2), col='blue')
summary(biphas2)
AIC(biphas2)
anova(biphas2,model2)
predw2=predict(biphas2,WM)
RMSE(predw2,WM$`WB.7.0.7`)

biphas3=nls(`WB.21.0.3`~NO+log10(f*exp(-k1*Time3)+(1-f)*exp(-k2*Time3)), start = list(f=0.8,k1=0.1,k2=0.01,NO=6), trace = T, data=WM)
plot(`WB.21.0.3`~Time3, data =WM)
lines(WM$Time3, predict(biphas3), col='blue')
summary(biphas3)
AIC(biphas3)
anova(biphas3,model3)
predw3=predict(biphas3,WM)
RMSE(pred3,WM$`WB.21.0.3`)

biphas4=nls(`WB.21.0.7`~NO+log10(f*exp(-k1*Time4)+(1-f)*exp(-k2*Time4)), start = list(f=0.99,k1=0.3,k2=0.01,NO=6), trace = T, data=WM)
plot(`WB.21.0.7`~Time4, data =WM)
lines(WM$Time4, predict(biphas4), col='blue')
summary(biphas4)
AIC(biphas4)
anova(biphas4,model4, weib4)
predw6=predict(biphas4,WM)
RMSE(predw6,WM$`WB.21.0.7`)

biphas5=nls(`WB.37.0.3`~NO+log10(f*exp(-k1*Time5)+(1-f)*exp(-k2*Time5)), start = list(f=0.99,k1=0.3,k2=0.01,NO=6), trace = T, data=WM)
plot(`WB.37.0.3`~Time5, data =WM)
lines(WM$Time5, predict(biphas5), col='blue')
summary(biphas5)
AIC(biphas5)
anova(biphas5,model5)
predw6=predict(biphas5,WM)
RMSE(predw6,WM$`WB.37.0.3`)

biphas6=nls(`WB.37.0.7`~NO+log10(f*exp(-k1*Time6)+(1-f)*exp(-k2*Time6)), start = list(f=0.5,k1=1,k2=0.01,NO=6), trace = T, data=WM)
plot(`WB.21.0.7`~Time4, data =WM)
lines(WM$Time4, predict(biphas2), col='blue')
summary(biphas6)
AIC(biphas6)
anova(biphas6,model6)
predw6=predict(biphas6,WM)
RMSE(predw6,WM$`WB.37.0.7`)

################Baranyi
BR1=nls(`WB.37.0.7`~NO+(u/log(10))*(Time6-(1/log(10)))*log(1+((exp(u*Time6)-1)/(10^(NF-NO)))), start = list(u=-0.1,NF=4,NO=6), trace = T, data=WM)

plot(`WB.37.0.7`~Time6, data =WM)
lines(WM$Time6, predict(BR1), col='blue')
exp(-0.08)*(7-1)

10^(4-6)

log(0.01)
1/log(10)


-(1/log(10))*log(1+(exp(-0.08)*(7-1))/10^-2)
