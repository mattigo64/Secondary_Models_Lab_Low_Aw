library(readxl)
WM = read_excel("~/Dropbox/Matt Igo - Schaffner Lab/Dissertation/Lab Modeling Project/Results/Results.xlsx", 
                sheet = "ModelR")

library(caret)
model1 = lm(`WL.7.0.3`~Time7, data = WM)
summary(model1)
AIC(model1)
pred1=predict(model1,WM)
RMSE(pred1,WM$`WL.7.0.3`)

model2 = lm(`WL.7.0.7`~Time8, data = WM)
summary(model2)
AIC(model2)
pred2=predict(model2,WM)
RMSE(pred2,WM$`WL.7.0.7`)

model3 = lm(`WL.21.0.3`~Time9, data = WM)
summary(model3)
AIC(model3)
pred3=predict(model3,WM)
RMSE(pred3,WM$`WL.21.0.3`)

model4 = lm(`WL.21.0.7`~Time10, data = WM)
summary(model4)
AIC(model4)
pred4=predict(model4,WM)
RMSE(pred4,WM$`WL.21.0.7`)

model5 = lm(`WL.37.0.3`~Time11, data = WM)
summary(model5)
AIC(model5)
pred5=predict(model5,WM)
RMSE(pred5,WM$`WL.37.0.3`)

model6 = lm(`WL.37.0.7`~Time12, data = WM)
summary(model6)
AIC(model6)
pred6=predict(model6,WM)
RMSE(pred6,WM$`WL.37.0.7`)


###############Weibull
weib1 = nls(`WL.7.0.3`~NO - (Time1/delta)^p, start = list(delta =5, p=1, NO=5), trace = T, data = WM)
summary(weib1)
AIC(weib1)
anova(weib1,model1)
predw1=predict(weib1,WM)
RMSE(predw1,WM$`WL.7.0.3`)
anova(weib1,model1)
plot(`WL.7.0.3`~Time1, data =WM)
lines(WM$Time1, predict(weib1), col='blue')

weib2 = nls(`WL.7.0.7`~NO - (Time2/delta)^p, start = list(delta =5, p=1, NO=5), trace = T, data = WM)
summary(weib2)
AIC(weib2)
anova(weib2,model2)
predw2=predict(weib2,WM)
RMSE(predw2,WM$`WL.7.0.7`)

weib3 = nls(`WL.21.0.3`~NO - (Time3/delta)^p, start = list(delta =5, p=1, NO=5), trace = T, data = WM)
summary(weib3)
AIC(weib3)
anova(weib3,model3)
predw3=predict(weib3,WM)
RMSE(predw3,WM$`WL.21.0.3`)

weib4 = nls(`WL.21.0.7`~NO - (Time10/delta)^p, start = list(delta =5, p=0.5, NO=5), trace = T, data = WM)
summary(weib4)
AIC(weib4)
anova(weib4,model4)
predw4=predict(weib4,WM)
RMSE(predw4,WM$`WL.21.0.7`)
plot(`WL.21.0.7`~Time10, data =WM)
lines(WM$Time10, predict(weib4), col='blue')

weib5 = nls(`WL.37.0.3`~NO - (Time5/delta)^p, start = list(delta =5, p=1, NO=5), trace = T, data = WM)
summary(weib5)
AIC(weib5)
anova(weib5,model5)
predw5=predict(weib5,WM)
RMSE(predw5,WM$`WL.37.0.3`)

weib6 = nls(`WL.37.0.7`~NO - (Time5/delta)^p, start = list(delta =1, p=1, NO=5), trace = T, data = WM)
summary(weib6)
AIC(weib6)
anova(weib6,model6)
predw6=predict(weib6,WM)
RMSE(predw6,WM$`WL.37.0.7`)

###################Biphasic
library(nlsr)
?`nlsr-package`
biphas1=nls(`WL.7.0.3`~NO+log10(f*exp(-k1*Time1)+(1-f)*exp(0*Time1)), start = list(f=1,k1=0.02,NO=6), trace = T, data=WM)
plot(`WL.7.0.3`~Time1, data =WM)
lines(WM$Time1, predict(biphas1), col='blue')
summary(biphas1)
AIC(biphas1)
anova(biphas1,model1)
predw1=predict(biphas1,WM)
RMSE(predw1,WM$`WL.7.0.3`)

biphas2=nls(`WL.7.0.7`~NO+log10(f*exp(-k1*Time1)+(1-f)*exp(-k2*Time1)), start = list(f=0.99,k1=0.3,k2=0.01,NO=6), trace = T, data=WM)
plot(`WL.7.0.7`~Time2, data =WM)
lines(WM$Time2, predict(biphas2), col='blue')
summary(biphas2)
AIC(biphas2)
anova(biphas2,model2)
predw2=predict(biphas2,WM)
RMSE(predw2,WM$`WL.7.0.7`)

biphas3=nls(`WL.21.0.3`~NO+log10(f*exp(-k1*Time3)+(1-f)*exp(-k2*Time3)), start = list(f=0.8,k1=0.1,k2=0.01,NO=6), trace = T, data=WM)
plot(`WL.21.0.3`~Time3, data =WM)
lines(WM$Time3, predict(biphas3), col='blue')
summary(biphas3)
AIC(biphas3)
anova(biphas3,model3)
predw3=predict(biphas3,WM)
RMSE(predw3,WM$`WL.21.0.3`)

biphas4=nls(`WL.21.0.7`~NO+log10(f*exp(-k1*Time3)+(1-f)*exp(-k2*Time3)), start = list(f=0.8,k1=0.1,k2=0.01,NO=6), trace = T, data=WM)
plot(`WL.21.0.7`~Time3, data =WM)
lines(WM$Time3, predict(biphas4), col='blue')
summary(biphas4)
AIC(biphas4)
anova(biphas4,model4)
predw6=predict(biphas4,WM)
RMSE(predw6,WM$`WL.21.0.7`)

biphas5=nls(`WL.37.0.3`~NO+log10(f*exp(-k1*Time5)+(1-f)*exp(-k2*Time5)), start = list(f=0.99,k1=0.3,k2=0.01,NO=6), trace = T, data=WM)
plot(`WL.37.0.3`~Time5, data =WM)
lines(WM$Time5, predict(biphas5), col='blue')
summary(biphas5)
AIC(biphas5)
anova(biphas5,model5)
predw5=predict(biphas5,WM)
RMSE(predw5,WM$`WL.37.0.3`)

biphas6=nls(`WL.37.0.7`~NO+log10(1*exp(-k1*Time5)+(1-0.999997)*exp(-k2*Time5)), start = list(k1=0.2599,k2=0.0335,NO=8.2), trace = T, data=WM)
plot(`WL.37.0.7`~Time5, data =WM)
lines(WM$Time5, predict(biphas6), col='blue')
summary(biphas6)
AIC(biphas6)
anova(biphas6,model6)
predw6=predict(biphas6,WM)
RMSE(predw6,WM$`WL.37.0.7`)
